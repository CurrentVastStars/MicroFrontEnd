#创建命名空间
apiVersion: v1
kind: Namespace
metadata:
  name: irobotbox-dataanalysis
#创建登录Harbor的密钥
---
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJyZWdpc3RyeS12cGMuY24taGFuZ3pob3UuYWxpeXVuY3MuY29tIjp7InVzZXJuYW1lIjoiMTI3ODYwMTc0NUBxcS5jb20iLCJwYXNzd29yZCI6IlNIQDIwMTkjYWxpeXVuIiwiYXV0aCI6Ik1USTNPRFl3TVRjME5VQnhjUzVqYjIwNlUwaEFNakF4T1NOaGJHbDVkVzQ9In19fQ==
kind: Secret
metadata:
  name: register-aliyuncs
  namespace: irobotbox-dataanalysis
type: kubernetes.io/dockerconfigjson
---
apiVersion: v1
kind: Secret
metadata:
  name: irobotbox-tls
  namespace: irobotbox-dataanalysis
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZ1VENDQktHZ0F3SUJBZ0lRQXBzUlR3NWQzdWRqUW8xSExlZmtPekFOQmdrcWhraUc5dzBCQVFzRkFEQmUKTVFzd0NRWURWUVFHRXdKVlV6RVZNQk1HQTFVRUNoTU1SR2xuYVVObGNuUWdTVzVqTVJrd0Z3WURWUVFMRXhCMwpkM2N1WkdsbmFXTmxjblF1WTI5dE1SMHdHd1lEVlFRREV4UlNZWEJwWkZOVFRDQlNVMEVnUTBFZ01qQXhPREFlCkZ3MHhPVEV4TVRRd01EQXdNREJhRncweU1UQXhNVEl4TWpBd01EQmFNQm94R0RBV0JnTlZCQU1NRHlvdWFYSnYKWW05MFltOTRMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUdqU09lMQoxeUdiUTd2Sy9OOVc1RWhjYkJYWXRJa2h1M3pIZENNV3hrSzg5TFlkc0lKeGx2bXlnbThsTEp5eWE4NlFtajZSCi9nYlJUdEY1cmtyZEoxWTY1SlVuMmw5UGtyN1hOenZjK3k5ZVRYdWZWOStrdGJaQm8wQjdrcS9wUmxqclNrZWwKclJSRlZCemRQM3pxVmVCZmlWWTdLaWRsV2d3MG5FOEljZmxpS3g4WmF4cFVNcVpDTUplRWdvZjFIanI1dlZ0NQptMUg1UG9ma1FoNHYwTDB5WlU1emlrQUFkSUZDRFhHTWNKYXR4R01jVTVGaWh5MC9vZzVMbUVDck5FdElTajRUClk2azl0emZranNDZEd2OWtFYVJYVkZMMVByVjBHWklRZ1VDd3I4WUJjS05Td1VBeDQ1L0c4V0dweWlZY1c4VjcKU21OV2VHdUswSk9lbkprQ0F3RUFBYU9DQXJVd2dnS3hNQjhHQTFVZEl3UVlNQmFBRkZQS0YxbjhhOEFESVM4YQpydVNxcUJ5Q1Z0cDFNQjBHQTFVZERnUVdCQlFtaTV2TmpHeFpXUHJnY3BlODNsU3BweHl0MFRBcEJnTlZIUkVFCklqQWdnZzhxTG1seWIySnZkR0p2ZUM1amIyMkNEV2x5YjJKdmRHSnZlQzVqYjIwd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakErQmdOVkhSOEVOekExTURPZwpNYUF2aGkxb2RIUndPaTh2WTJSd0xuSmhjR2xrYzNOc0xtTnZiUzlTWVhCcFpGTlRURkpUUVVOQk1qQXhPQzVqCmNtd3dUQVlEVlIwZ0JFVXdRekEzQmdsZ2hrZ0JodjFzQVFJd0tqQW9CZ2dyQmdFRkJRY0NBUlljYUhSMGNITTYKTHk5M2QzY3VaR2xuYVdObGNuUXVZMjl0TDBOUVV6QUlCZ1puZ1F3QkFnRXdkUVlJS3dZQkJRVUhBUUVFYVRCbgpNQ1lHQ0NzR0FRVUZCekFCaGhwb2RIUndPaTh2YzNSaGRIVnpMbkpoY0dsa2MzTnNMbU52YlRBOUJnZ3JCZ0VGCkJRY3dBb1l4YUhSMGNEb3ZMMk5oWTJWeWRITXVjbUZ3YVdSemMyd3VZMjl0TDFKaGNHbGtVMU5NVWxOQlEwRXkKTURFNExtTnlkREFKQmdOVkhSTUVBakFBTUlJQkF3WUtLd1lCQkFIV2VRSUVBZ1NCOUFTQjhRRHZBSFlBcExrSgprTFFZV0JTSHV4T2l6R2R3Q2p3MW1BVDVHOSs0NDNmTkRzZ04zQkFBQUFGdVovb1pLZ0FBQkFNQVJ6QkZBaUVBCmxEYTNjYUVBWFU3aEhvWGx3bFlPR3VVMGJSLzR3WXJuUURCMmhwN3N3RWtDSUc0cnhJN1ZXUWNmV25TMnZGY3EKYktkRDdEdFVZUklPRllQTGdzMEZvU3dVQUhVQVJKUmxMckR1enEvRVFBZllxUDRvd05ybWdyN1l5ekcxUDlNegpsclcyZ2FnQUFBRnVaL29ZdGdBQUJBTUFSakJFQWlBTHpSQ2FHbmY4STgxbFBlNlg5VGE5RTVneDhqRlJ2YzEzCkFXMEpDbkcrY2dJZ1RXL3ZiSGVKK3BnaWM4eGdRelI2TVhObnlyeGRzM2w1THdVNWhGUEdyeWd3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFFWlM1dUQ5aVMxd0wvK2hPL3c5N2tRNEg2NCtSNmovV1MraHQ5TXBIU25XNWp5ZQpuZjRsdWovcGRFWHlFUWJUYUFTYlhxbUdXbWMvL2d4NVRmU2N3bEVGcHNDaS84bnlVNm5oZC9SMFVmRHdrSDVlCnkvN29EUndRdUtVaVZ3VEJwS1Z2ZHUrL2FBRXNyR1F5bmpuL2xVN1RxcG9TY3BPTFN2RE9zZ3lObkt6MC9uK1QKZ2VRTU1rMVBGbnZFOXRKL0NTVTRGY1JIRm9QRGRwc3B6RDRiU3V1a0tWY202Y0ZSY01PdmtTR1FyMVk5RUgvcApFOFBVWjlLemJ2aGYyV0RTRkFLWExlcUVpWnBUbVVwMUpHbGxRU1NrQVg2NXBJakRiM3BzTUdqWFgzUW15T1lHCnZsMnNXNkxGeGwxWXRhRVJyRXNSVitYWlhHK05PSkNTWFN4cDFLRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRXNUQ0NBNW1nQXdJQkFnSVFDS1dpUnMxTFhJeUQxd0swdTZ0VFNUQU5CZ2txaGtpRzl3MEJBUXNGQURCaApNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ2hNTVJHbG5hVU5sY25RZ1NXNWpNUmt3RndZRFZRUUxFeEIzCmQzY3VaR2xuYVdObGNuUXVZMjl0TVNBd0hnWURWUVFERXhkRWFXZHBRMlZ5ZENCSGJHOWlZV3dnVW05dmRDQkQKUVRBZUZ3MHhOekV4TURZeE1qSXpNek5hRncweU56RXhNRFl4TWpJek16TmFNRjR4Q3pBSkJnTlZCQVlUQWxWVApNUlV3RXdZRFZRUUtFd3hFYVdkcFEyVnlkQ0JKYm1NeEdUQVhCZ05WQkFzVEVIZDNkeTVrYVdkcFkyVnlkQzVqCmIyMHhIVEFiQmdOVkJBTVRGRkpoY0dsa1UxTk1JRkpUUVNCRFFTQXlNREU0TUlJQklqQU5CZ2txaGtpRzl3MEIKQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBNVMyb2loRW85bm5wZXpvemlEdHg0V1dMTENsbC9lMHQxRVllbUU1bgorTWdQNXZpYUhMeStWcEhQK25kWDVEMThJTkl1dUFWOHdGcTI2S0Y1VTBXTklaaVFwNm1MdElXalVlV0RQQTI4Ck9leWhUbGo5VExrMmJleXRidEZVNnlwYnBXVWx0bXZZNVY4bmdzcEM3bkZSTkNqcGZuREVEMmtSeUp6Tzh5b0sKTUZ6NEo0SkU4TjdOQTF1SndVRUZNVXZITHMwc2NMb1Baa0tjZXdJUm0xUlYyQXhtRlF4SmtkZjdZTjlQY2traQpmMlhnbTNiNDhCWm4wemYwcVhzU2VHdTg0dWE5Z3d6anpJN3RiVEJqYXlUcFQrL1hwV3VCVnY2ZnZhckk2YmlrCktCODU5T1NHUXV3NzNYWGdldUZ3RVBIVElSb1V0a3p1My9FUStMdHd6bmtrZFFJREFRQUJvNElCWmpDQ0FXSXcKSFFZRFZSME9CQllFRkZQS0YxbjhhOEFESVM4YXJ1U3FxQnlDVnRwMU1COEdBMVVkSXdRWU1CYUFGQVBlVURWVwowVXk3WnZDajRoc2J3NWV5UGRGVk1BNEdBMVVkRHdFQi93UUVBd0lCaGpBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGCkJRY0RBUVlJS3dZQkJRVUhBd0l3RWdZRFZSMFRBUUgvQkFnd0JnRUIvd0lCQURBMEJnZ3JCZ0VGQlFjQkFRUW8KTUNZd0pBWUlLd1lCQlFVSE1BR0dHR2gwZEhBNkx5OXZZM053TG1ScFoybGpaWEowTG1OdmJUQkNCZ05WSFI4RQpPekE1TURlZ05hQXpoakZvZEhSd09pOHZZM0pzTXk1a2FXZHBZMlZ5ZEM1amIyMHZSR2xuYVVObGNuUkhiRzlpCllXeFNiMjkwUTBFdVkzSnNNR01HQTFVZElBUmNNRm93TndZSllJWklBWWI5YkFFQ01Db3dLQVlJS3dZQkJRVUgKQWdFV0hHaDBkSEJ6T2k4dmQzZDNMbVJwWjJsalpYSjBMbU52YlM5RFVGTXdDd1lKWUlaSUFZYjliQUVCTUFnRwpCbWVCREFFQ0FUQUlCZ1puZ1F3QkFnSXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSDRqeC9MS05XNVprbEZjCllXczhFamJtMG55ektlWkMyS09WWVI3UDhnZXZLeXNsV200WG80QlN6S3IyMzVGc0o0YUZ0NnlBaXYxZVkwdFoKL1pOMThiT0dTR1N0b0VjL0pFNG9jSXpyOFA1TWcxMWtSWUhibWdZbnIxUnhla2k1bVNlYjM5REd4VHBKRDRrRwpoczVsWE5vbzRjb25VaWlKd0thcUg3dmgyYmFyeWQ4cE1JU2FnODNKVXF5VkdjMnRXUHBPMDMyOS9DV3Eya3J5CnF2NjZPU01qd3VsVXowZFhmNE9IUWFzUjdDTmZJcis0S1NjYzZBQmxRNVJERjg2UEdlRTZrZHdTUWtGaUIvY1EKeXNOeXEwakVEUVRrZmEycGptdVd0TUNOYkJuaEZYQlllamZ1YkloYVViRXYyRk9RQjNkQ2F2K0ZQZzVlRXZlWApUVnlNbkdvPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBd2FOSTU3WFhJWnREdThyODMxYmtTRnhzRmRpMGlTRzdmTWQwSXhiR1FyejB0aDJ3CmduR1crYktDYnlVc25MSnJ6cENhUHBIK0J0Rk8wWG11U3QwblZqcmtsU2ZhWDArU3Z0YzNPOXo3TDE1TmU1OVgKMzZTMXRrR2pRSHVTcitsR1dPdEtSNld0RkVWVUhOMC9mT3BWNEYrSlZqc3FKMlZhRERTY1R3aHgrV0lySHhscgpHbFF5cGtJd2w0U0NoL1VlT3ZtOVczbWJVZmsraCtSQ0hpL1F2VEpsVG5PS1FBQjBnVUlOY1l4d2xxM0VZeHhUCmtXS0hMVCtpRGt1WVFLczBTMGhLUGhOanFUMjNOK1NPd0owYS8yUVJwRmRVVXZVK3RYUVpraENCUUxDdnhnRncKbzFMQlFESGpuOGJ4WWFuS0poeGJ4WHRLWTFaNGE0clFrNTZjbVFJREFRQUJBb0lCQVFDQ3RjVk4zRHEzVGNiQQpLbnJlREJxWEdnUkFEd04zR2hVa1dzTHp1TGptYmdUR05tNWk3MmhaYjMyS3AwNWhERE9ud1liTk8rRjlHcWNZCjBnbXNNWE1QU3p2bnozb2lJbVhOZXh1bXhqbXN0UHlhdVdvbzVsZGZDeG0zT25NL1dibUo1bkpDd1B4L2xYajgKN3dDZlF0UHJYTElwU2xEZlBSUTI3d0NnZlBQcXdZUHh4VmEvZVl5ZDU2N3h4YnFYT1ZUdm9iTG5MT2VlYWpNYwoyYXZNVnhCUit2Umt3NHREdnRVeTg0clFNMlB6dEVFYWJPc1hDU3l4dUc0L0o3bGRzTndKc1A1YXg4ZHhzSkVsClZZVXlVa1c4dnlvQ25VMW1oakhIYW5mRm5mVzZtWUs0SkgxRGZiSTVlR3lrWkx3UkszTUg0T3prdW1MTlJ0M0oKRUZMbDdHWU5Bb0dCQU9OQmU1LzJpa0lQRndqdjl1RUE5YW5BVzRud3RXL000SWNLWTdtcFU3STV6VDlvclRneApaSmpIVGNtQkcyb1NuMVpWeGt2RnZEeFplV3ZWYnp2N3pzMk0wdUpnbHd2M1VWREhwa3Z6Z1ZSWVRrQ2tsNFhpCnViVlVtZS9RekYvRjg3eDVsb1hlVUREN2tKR2ZqeXp4T2lFci9KY1ltNUQ5RjBLMHFXV2l2SDdIQW9HQkFOb2gKUVl5N0ZPZ1h5ZlltNm10ZEZ6Ym5BdjNKUTlnZ0RoKzdnaU5Ud3F2SThFekIyRm9VNUlYWXMxNU1vb05LQ0F4WQpQVmRZb1hCVGM4OEdEQ2xvSnl4cWlJQnhYQW9rNGdmLzBIdTFnZVp6Wkl2cGpLbTc2M2dydVA0TUVUU1VDVTk3CndnRmErVTV2NDEwa01wcFhWZ2VHWEVVaHJZYmlEbXZmZXRBbjBpbWZBb0dBYWlrUjdqVUdlenQvWUQ1eERzVWEKL2JTTlRvL3l3Z3BzTE1sT3N0R0Y5ckVIejRJL3dRdFoyZ0RvdHFRb1FWSDN1eVlRbng3OUF4Z3RINUd5Qjh4bQozQ0RYOXNaMmFUR2NlK2I0S1d6VVVxbDV6THJXeWNXVFNVRC9ORWRPNGNLZ1RNQmo3NTlkeUxRTDRlc3V3Q2prCkpkRGRpMXdFZUNPeTlRZGVSc3RSME1zQ2dZRUFxc3ROV3hjRlNMR1B4bmcwSnZyTitZUXFtSEtsOTYwcHdmajgKN2hKZ3BFZUN1R2N6czEwV2ppTGVWMkRrQXE3TjNIU2ZHeXhmdytia0Q5NnBXU2FmUGF6dzBybHdHdFZFVW9VZwpSaTBaMkVyVUdLVTNLWlBsek1OWFp6d2xvS2lsSGFKR2h1OG50QjN4eGZWWTFmYTZlc3ZlcFphNEc1d1hOS25ZCnJQSHhJZnNDZ1lFQWxCOW5BeVpQVXYxcTdMT3Z0N1lIdEp1SGFhTG9lRTFPd245SWxUTHArRjZ3UGpUbXF6YzUKQ0c1S0hRbFFMWldYeUVmWlVjSS9QcWVBdWNGVkdOT2dQaktSU09FWXVuNnN5cDVsWVROK2x0ODZ0YU4wdGRYQgpka3NEZkRNaG9rUXorVHFkaVVaUUh6UDJldkRSVXNjSGJ4SUxFTTlVZGYvemV1RW1lUkQxSCtrPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQ==
type: IngressTLS
#配置部署
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: whalesystem-webui
  namespace: irobotbox-dataanalysis
  labels:
    app: whalesystem-webui
spec:
  selector:
    matchLabels:
      app: whalesystem-webui
  replicas: 2
  template:
    metadata:
      labels:
        app: whalesystem-webui
    spec:
      imagePullSecrets:
      - name: register-aliyuncs
      containers:

      - image: registry.cn-hangzhou.aliyuncs.com/irobotbox/whalesystem-webui:latest
        name: whalesystem-webui
        imagePullPolicy: Always
        env:
        - name: TZ
          value: Asia/Shanghai
        resources:
          requests:
            memory: "256Mi"
            cpu: "50m"
          limits:
            memory: "384Mi"
            cpu: "300m"
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    traefik.backend.circuitbreaker: NetworkErrorRatio() > 0.5
    traefik.backend.loadbalancer.method: drr
  name: svc-whalesystem-webui
  namespace: irobotbox-dataanalysis
spec:
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800
  ports:
  - name: whalesystem-webui-port
    port: 80
    protocol: TCP
    targetPort: 80
  selector:
    app: whalesystem-webui
  type: NodePort
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: ingress-whalesystem-webui
  namespace: irobotbox-dataanalysis
  annotations:
    kubernetes.io/ingress.class: "nginx"
    ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/use-regex: "true"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-body-size: "20m"
spec:
  rules:
  - host: bi.irobotbox.com
    http:
      paths:
        - backend:
            serviceName: svc-whalesystem-webui
            servicePort: 80
          path: /
  tls:
    - hosts:
        - bi.irobotbox.com
      secretName: irobotbox-tls
